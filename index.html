<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise Visual Dia de Sorte</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        diasorte: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                            700: '#b45309',
                            800: '#92400e',
                            900: '#78350f',
                            primary: '#f59e0b',
                            950: '#451a03',
                            975: '#1c0701'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .number-ball {
            transition: all 0.2s ease;
        }
        .number-ball:hover {
            transform: scale(1.1);
        }
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #f59e0b;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .responsive {
            width: 100% !important;
            height: auto !important;
            max-width: 400px;
            display: block;
            margin: 0 auto;
        }
        @media (max-width: 768px) {
            .responsive {
                max-width: 150px;
            }
        }
        @media (max-width: 480px) {
            .responsive {
                max-width: 120px;
            }
        }
        
        /* M√™s da sorte destacado */
        .mes-sorte {
            background: linear-gradient(135deg, #f59e0b, #fbbf24) !important;
            color: white !important;
            border: 2px solid #d97706 !important;
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3) !important;
            transform: scale(1.05) !important;
            font-weight: bold !important;
        }
		 .responsive {
            width: 100% !important;
            height: auto !important;
            max-width: 400px;
            display: block;
            margin: 0 auto;
        }
        @media (max-width: 768px) {
            .responsive {
                max-width: 150px;
            }
        }
        @media (max-width: 480px) {
            .responsive {
                max-width: 120px;
            }
        }

    </style>
</head>
<body class="bg-diasorte-50 dark:bg-gray-900 min-h-screen">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 py-6 text-center">
		      <div class="flex items-center justify-center gap-3 mb-2">
                <div class="flex items-center gap-2">
                    <img src="https://i.postimg.cc/3R2PytCp/diadesorte.png" alt="Quina" class="responsive">
                </div>
            </div>

		
		
            <div class="flex items-center justify-center gap-4">
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
                    An√°lise Visual 
                    <span class="text-diasorte-primary bg-gradient-to-r from-diasorte-600 to-diasorte-800 bg-clip-text text-transparent font-extrabold">DIA DE SORTE</span>
                </h1>
                <button id="helpBtn" class="bg-diasorte-primary hover:bg-diasorte-700 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-colors">
                    ?
                </button>
            </div>
            <p class="text-gray-600 dark:text-gray-400 mt-2">An√°lise inteligente baseada em dados reais da API oficial da Caixa</p>
        </div>
    </header>

    <!-- Controls -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="bg-gradient-to-r from-diasorte-100 via-diasorte-50 to-white dark:from-gray-800 dark:via-gray-700 dark:to-gray-800 rounded-lg shadow-sm p-6 mb-6 border border-diasorte-200 dark:border-gray-600">
            <div class="flex flex-wrap items-center justify-center md:justify-start gap-4">
                <!-- Load Button -->
                <div class="bg-diasorte-200 dark:bg-diasorte-900 p-3 rounded-lg">
                    <button id="loadBtn" class="bg-diasorte-primary hover:bg-diasorte-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-6 py-2 rounded-lg transition-all duration-300 flex items-center gap-2 min-w-[200px] justify-center">
                        <div id="loadSpinner" class="loading-spinner hidden"></div>
                        <span id="loadText">Carregar Resultados</span>
                    </button>
                </div>

                <!-- View Type -->
                <div class="bg-diasorte-100 dark:bg-diasorte-950 p-3 rounded-lg flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Visualiza√ß√£o:</label>
                    <select id="viewType" class="border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <option value="grid">Grade 6x6</option>
                        <option value="horizontal">Linha Horizontal</option>
                        <option value="vertical">Lista Vertical</option>
                        <option value="compact">Compacto</option>
                        <option value="circles">C√≠rculos</option>
                    </select>
                </div>

                <!-- Sort Order -->
                <div class="bg-diasorte-300 dark:bg-diasorte-975 p-3 rounded-lg flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Ordem:</label>
                    <select id="sortOrder" class="border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <option value="desc">Mais Recente</option>
                        <option value="asc">Mais Antigo</option>
                    </select>
                </div>

                <!-- Columns -->
                <div class="bg-diasorte-200 dark:bg-diasorte-900 p-3 rounded-lg flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Colunas:</label>
                    <select id="columns" class="border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <option value="1">1 Coluna</option>
                        <option value="2">2 Colunas</option>
                        <option value="3" selected>3 Colunas</option>
                        <option value="4">4 Colunas</option>
                        <option value="5">5 Colunas</option>
                    </select>
                </div>

                <!-- Show Info Toggle -->
                <div class="bg-diasorte-100 dark:bg-diasorte-950 p-3 rounded-lg">
                    <button id="showInfoBtn" class="flex items-center gap-2 cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-diasorte-primary">
                        <div class="w-5 h-5 bg-diasorte-primary text-white rounded-full flex items-center justify-center text-xs font-bold">
                            <span id="toggleIcon">‚àí</span>
                        </div>
                        <span>Info Concursos</span>
                    </button>
                    <input type="checkbox" id="showInfo" checked class="hidden">
                </div>

                <!-- Limit -->
                <div class="bg-diasorte-300 dark:bg-diasorte-975 p-3 rounded-lg flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Carregar:</label>
                    <select id="limit" class="border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <option value="50">Do 1¬∫ ao 50¬∫ concurso</option>
                        <option value="100">Do 1¬∫ ao 100¬∫ concurso</option>
                        <option value="200">Do 1¬∫ ao 200¬∫ concurso</option>
                        <option value="500">Do 1¬∫ ao 500¬∫ concurso</option>
                        <option value="1000">Do 1¬∫ ao 1000¬∫ concurso</option>
                        <option value="metade">Do 1¬∫ at√© a metade</option>
                        <option value="todos">Do 1¬∫ ao √∫ltimo concurso</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Results Info -->
        <div id="resultsInfo" class="hidden bg-diasorte-100 dark:bg-diasorte-950 border border-diasorte-300 dark:border-diasorte-800 rounded-lg p-4 mb-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-diasorte-primary text-white px-3 py-1 rounded-full text-sm font-bold">
                        <span id="loadedCount">0</span> concursos
                    </div>
                    <span class="text-gray-700 dark:text-gray-300 text-sm">carregados com sucesso</span>
                </div>
                <button id="clearResults" class="text-gray-500 hover:text-red-500 text-sm underline">
                    Limpar resultados
                </button>
            </div>
        </div>

        <!-- Results -->
        <div id="results" class="grid gap-4"></div>

        <!-- Statistics -->
        <div id="statistics" class="hidden mt-4 bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between mb-3">
                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Estat√≠sticas Par/√çmpar</h4>
                <span class="text-xs text-gray-500 dark:text-gray-400" id="tendency">Equilibrado</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-xs">
                    <thead>
                        <tr class="border-b border-gray-200 dark:border-gray-600">
                            <th class="text-left py-1 text-gray-600 dark:text-gray-400">Tipo</th>
                            <th class="text-center py-1 text-gray-600 dark:text-gray-400">Total</th>
                            <th class="text-center py-1 text-gray-600 dark:text-gray-400">M√©dia</th>
                            <th class="text-center py-1 text-gray-600 dark:text-gray-400">%</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-700 dark:text-gray-300">
                        <tr class="border-b border-gray-100 dark:border-gray-700">
                            <td class="py-1 flex items-center gap-1">
                                <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                <span class="font-medium">√çmpares</span>
                            </td>
                            <td class="text-center py-1 font-mono" id="oddTotal">0</td>
                            <td class="text-center py-1 font-mono" id="oddAverage">0</td>
                            <td class="text-center py-1 font-mono" id="oddFrequency">0%</td>
                        </tr>
                        <tr>
                            <td class="py-1 flex items-center gap-1">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                <span class="font-medium">Pares</span>
                            </td>
                            <td class="text-center py-1 font-mono" id="evenTotal">0</td>
                            <td class="text-center py-1 font-mono" id="evenAverage">0</td>
                            <td class="text-center py-1 font-mono" id="evenFrequency">0%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-600 flex justify-between items-center text-xs text-gray-500 dark:text-gray-400">
                <span>Mais sorteado: <span id="mostDrawn" class="font-medium">-</span></span>
                <span>M√™s mais sorteado: <span id="mostDrawnMonth" class="font-medium">-</span></span>
            </div>
        </div>

        <!-- Error -->
        <div id="error" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded-lg mt-4"></div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-diasorte-primary to-diasorte-700 text-white p-6 rounded-t-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                            <span class="text-diasorte-primary font-bold text-sm">DIA</span>
                        </div>
                        <h2 class="text-xl font-bold">Como usar a An√°lise Visual Dia de Sorte</h2>
                    </div>
                    <button id="closeModal" class="text-white hover:text-gray-300 text-2xl font-bold">√ó</button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="p-6 space-y-6">
                <section>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Sobre o Dia de Sorte</h3>
                    <p class="text-gray-700 dark:text-gray-300 leading-relaxed">
                        O Dia de Sorte possui 31 n√∫meros (1 a 31) representando os dias do m√™s. 
                        S√£o sorteados 7 n√∫meros + 1 m√™s da sorte. Esta ferramenta utiliza a API oficial da Caixa 
                        para exibir os resultados hist√≥ricos com estat√≠sticas detalhadas.
                    </p>
                </section>

                <section>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Como Interpretar</h3>
                    <div class="space-y-3">
                        <div class="flex items-start gap-3">
                            <div class="w-4 h-4 bg-diasorte-primary rounded-full mt-1"></div>
                            <div>
                                <span class="font-medium text-gray-900 dark:text-white">N√∫meros Dourados:</span>
                                <span class="text-gray-700 dark:text-gray-300"> Foram sorteados no concurso</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="w-4 h-4 bg-gray-300 rounded-full mt-1"></div>
                            <div>
                                <span class="font-medium text-gray-900 dark:text-white">N√∫meros Cinza:</span>
                                <span class="text-gray-700 dark:text-gray-300"> N√£o foram sorteados no concurso</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="w-4 h-4 bg-green-500 rounded-full mt-1"></div>
                            <div>
                                <span class="font-medium text-gray-900 dark:text-white">M√™s Verde:</span>
                                <span class="text-gray-700 dark:text-gray-300"> M√™s da sorte do concurso</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Modal Footer -->
            <div class="bg-gray-50 dark:bg-gray-700 px-6 py-4 rounded-b-lg">
                <div class="flex justify-between items-center">
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        Jogue com responsabilidade. Esta ferramenta √© apenas para an√°lise estat√≠stica.
                    </p>
                    <button id="closeModalFooter" class="bg-diasorte-primary hover:bg-diasorte-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                        Entendi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Script Dia de Sorte iniciado');

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        let allResults = [];
        let monthStats = {};
        let isLoading = false;

        const monthNames = [
            '', 'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
            'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
        ];

        function generateSampleData(limit, startFrom = 1) {
            console.log(`üé≤ Gerando ${limit} concursos do Dia de Sorte...`);
            const sampleData = [];
            const startDate = new Date('2018-05-01'); // Data aproximada do in√≠cio do Dia de Sorte
            
            for (let i = 0; i < limit; i++) {
                const concursoNumber = startFrom + i;
                const date = new Date(startDate);
                date.setDate(date.getDate() + (i * 3)); // Aproximadamente 2-3 sorteios por semana
                
                // Gera 7 n√∫meros aleat√≥rios √∫nicos entre 1 e 31
                const dezenas = [];
                while (dezenas.length < 7) {
                    const num = Math.floor(Math.random() * 31) + 1;
                    if (!dezenas.includes(num)) {
                        dezenas.push(num);
                    }
                }
                dezenas.sort((a, b) => a - b);
                
                // Gera m√™s da sorte aleat√≥rio (1-12)
                const mesSorte = Math.floor(Math.random() * 12) + 1;
                
                sampleData.push({
                    numero: concursoNumber,
                    dataApuracao: date.toLocaleDateString('pt-BR'),
                    listaDezenas: dezenas.map(n => n.toString().padStart(2, '0')),
                    mesSorte: mesSorte.toString().padStart(2, '0')
                });
            }
            
            console.log(`‚úÖ Gerados ${sampleData.length} concursos do Dia de Sorte: ${sampleData[0]?.numero} at√© ${sampleData[sampleData.length-1]?.numero}`);
            return sampleData;
        }

        async function loadResults() {
            console.log('üîÑ loadResults chamado para Dia de Sorte');
            
            if (isLoading) {
                console.log('‚ö†Ô∏è J√° est√° carregando, ignorando');
                return;
            }
            
            isLoading = true;
            
            // Elementos do bot√£o
            const loadSpinner = document.getElementById('loadSpinner');
            const loadText = document.getElementById('loadText');
            const loadBtn = document.getElementById('loadBtn');
            
            if (loadSpinner) loadSpinner.classList.remove('hidden');
            if (loadBtn) loadBtn.disabled = true;
            
            // Determina quantos concursos carregar
            const limitSelect = document.getElementById('limit');
            const limitValue = limitSelect ? limitSelect.value : '50';
            
            let limit = 50;
            switch(limitValue) {
                case 'todos':
                    limit = 1000; // Dia de Sorte tem menos concursos
                    break;
                case 'metade':
                    limit = 500;
                    break;
                case '50':
                case '100':
                case '200':
                case '500':
                case '1000':
                    limit = parseInt(limitValue);
                    break;
            }
            
            // Limpa resultados anteriores
            allResults = [];
            monthStats = {};
            const resultsDiv = document.getElementById('results');
            if (resultsDiv) resultsDiv.innerHTML = '';
            
            try {
                console.log(`üéØ Carregando ${limit} concursos do Dia de Sorte`);
                
                // TENTA BUSCAR DA API REAL PRIMEIRO
                if (loadText) loadText.textContent = 'Conectando √† API...';
                
                try {
                    const latestResponse = await fetch('https://servicebus2.caixa.gov.br/portaldeloterias/api/diadesorte');
                    
                    if (latestResponse.ok) {
                        const latestData = await latestResponse.json();
                        const ultimoConcurso = latestData.numero;
                        console.log(`‚úÖ API Dia de Sorte conectada! √öltimo concurso: ${ultimoConcurso}`);
                        
                        // Ajusta limite baseado na API
                        let concursoFinal = Math.min(limit, ultimoConcurso);
                        
                        if (loadText) loadText.textContent = `Carregando 0/${concursoFinal}...`;
                        
                        // Busca cada concurso individualmente
                        for (let concurso = 1; concurso <= concursoFinal; concurso++) {
                            try {
                                // Atualiza progresso no bot√£o
                                if (loadText) loadText.textContent = `Carregando ${concurso}/${concursoFinal}...`;
                                
                                const response = await fetch(`https://servicebus2.caixa.gov.br/portaldeloterias/api/diadesorte/${concurso}`);
                                
                                if (response.ok) {
                                    const data = await response.json();
                                    if (data && data.listaDezenas && data.mesSorte) {
                                        allResults.push({
                                            numero: data.numero,
                                            dataApuracao: data.dataApuracao,
                                            listaDezenas: data.listaDezenas,
                                            mesSorte: data.mesSorte
                                        });
                                    }
                                }
                                
                                // Pequena pausa para n√£o sobrecarregar a API
                                if (concurso % 10 === 0) {
                                    await new Promise(resolve => setTimeout(resolve, 100));
                                }
                                
                            } catch (err) {
                                console.log(`Erro no concurso ${concurso}:`, err);
                            }
                        }
                        
                        console.log(`üéØ DADOS REAIS CARREGADOS: ${allResults.length}/${concursoFinal} concursos`);
                        
                    } else {
                        throw new Error(`API retornou erro: ${latestResponse.status}`);
                    }
                    
                } catch (apiError) {
                    console.error('‚ùå ERRO NA API:', apiError);
                    if (loadText) loadText.textContent = 'API falhou, gerando dados...';
                    
                    // Fallback: gera dados simulados com progresso
                    for (let i = 0; i < limit; i++) {
                        if (loadText) loadText.textContent = `Gerando ${i + 1}/${limit}...`;
                        
                        // Simula um pequeno delay para mostrar progresso
                        if (i % 100 === 0) {
                            await new Promise(resolve => setTimeout(resolve, 50));
                        }
                    }
                    
                    allResults = generateSampleData(limit);
                    console.log(`üîÑ DADOS SIMULADOS: ${allResults.length} concursos`);
                }
                
                // Se n√£o conseguiu dados suficientes da API, complementa
                if (allResults.length < limit) {
                    const missing = limit - allResults.length;
                    if (loadText) loadText.textContent = `Complementando ${missing} dados...`;
                    
                    const simulatedData = generateSampleData(missing, allResults.length + 1);
                    allResults = [...allResults, ...simulatedData];
                }
                
                // Finaliza o carregamento
                if (loadText) loadText.textContent = 'Processando dados...';
                
                // Ordena por n√∫mero do concurso
                allResults.sort((a, b) => a.numero - b.numero);
                
                renderResults();
                showResultsInfo();
                calculateStatistics();
                calculateMonthStats();
                
                console.log('‚úÖ Carregamento do Dia de Sorte conclu√≠do com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro no carregamento:', error);
                showError('Erro ao carregar resultados: ' + error.message);
            } finally {
                isLoading = false;
                
                // Remove loading
                if (loadSpinner) loadSpinner.classList.add('hidden');
                if (loadText) loadText.textContent = 'Carregar Resultados';
                if (loadBtn) loadBtn.disabled = false;
            }
        }

        function calculateMonthStats() {
            monthStats = {};
            
            // Inicializa contadores para todos os meses (1-12)
            for (let i = 1; i <= 12; i++) {
                monthStats[i] = 0;
            }
            
            // Conta frequ√™ncia de cada m√™s
            allResults.forEach(result => {
                if (result.mesSorte) {
                    const mes = parseInt(result.mesSorte);
                    if (mes >= 1 && mes <= 12) {
                        monthStats[mes]++;
                    }
                }
            });
            
            console.log('üìä Estat√≠sticas de meses calculadas:', monthStats);
        }

        function renderResults() {
            console.log(`üé® Renderizando ${allResults.length} resultados do Dia de Sorte`);
            
            const resultsDiv = document.getElementById('results');
            if (!resultsDiv) {
                console.error('‚ùå Elemento results n√£o encontrado');
                return;
            }
            
            if (allResults.length === 0) {
                console.log('‚ö†Ô∏è Nenhum resultado para renderizar');
                resultsDiv.innerHTML = '<p class="text-center text-gray-500">Nenhum resultado carregado</p>';
                return;
            }

            // Ordena√ß√£o
            const sortOrderSelect = document.getElementById('sortOrder');
            const sortOrder = sortOrderSelect ? sortOrderSelect.value : 'desc';
            
            const sortedResults = [...allResults].sort((a, b) => {
                return sortOrder === 'desc' ? b.numero - a.numero : a.numero - b.numero;
            });
            
            console.log(`üìä Ordena√ß√£o: ${sortOrder}, Primeiros 3: [${sortedResults.slice(0, 3).map(r => r.numero).join(', ')}]`);

            // Colunas
            const columnsSelect = document.getElementById('columns');
            const columnsCount = columnsSelect ? columnsSelect.value : '3';
            
            const gridCols = {
                '1': 'grid-cols-1',
                '2': 'grid-cols-1 md:grid-cols-2',
                '3': 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',
                '4': 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4',
                '5': 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5'
            };
            
            resultsDiv.className = `grid gap-4 ${gridCols[columnsCount]}`;

            // Criar cards
            const htmlCards = sortedResults.map(result => createResultCard(result));
            resultsDiv.innerHTML = htmlCards.join('');
            
            console.log(`‚úÖ ${htmlCards.length} cards renderizados no DOM`);
        }

        function createResultCard(result) {
            const showInfoCheckbox = document.getElementById('showInfo');
            const showInfo = showInfoCheckbox ? showInfoCheckbox.checked : true;
            
            const viewTypeSelect = document.getElementById('viewType');
            const viewType = viewTypeSelect ? viewTypeSelect.value : 'grid';
            
            const dezenas = result.listaDezenas.map(d => parseInt(d));
            const mesSorte = parseInt(result.mesSorte);
            const oddCount = dezenas.filter(num => num % 2 === 1).length;
            const evenCount = dezenas.filter(num => num % 2 === 0).length;
            
            const headerHTML = showInfo ? `
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-diasorte-100 to-diasorte-200 dark:from-diasorte-950 dark:to-diasorte-900">
                    <div class="flex justify-between items-center">
                        <div class="bg-diasorte-300 dark:bg-diasorte-800 px-3 py-1 rounded-lg">
                            <h3 class="font-semibold text-gray-900 dark:text-white">Concurso ${result.numero}</h3>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="bg-diasorte-200 dark:bg-diasorte-900 px-3 py-1 rounded-lg">
                                <p class="text-sm text-gray-700 dark:text-gray-300">${result.dataApuracao}</p>
                            </div>
                            <div class="bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 px-2 py-1 rounded-lg">
                                <p class="text-xs text-green-700 dark:text-green-300 font-medium">${monthNames[mesSorte]}</p>
                            </div>
                            <div class="bg-blue-100 dark:bg-blue-900 border border-blue-300 dark:border-blue-700 px-2 py-1 rounded-lg">
                                <p class="text-xs text-blue-700 dark:text-blue-300 font-medium">${oddCount} √≠mp</p>
                            </div>
                            <div class="bg-yellow-100 dark:bg-yellow-900 border border-yellow-300 dark:border-yellow-700 px-2 py-1 rounded-lg">
                                <p class="text-xs text-yellow-700 dark:text-yellow-300 font-medium">${evenCount} par</p>
                            </div>
                        </div>
                    </div>
                </div>
            ` : '';

            const numbersHTML = createNumbersDisplay(dezenas, viewType);

            return `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                    ${headerHTML}
                    <div class="p-4">
                        ${numbersHTML}
                    </div>
                </div>
            `;
        }

        function createNumbersDisplay(dezenas, viewType) {
            switch (viewType) {
                case 'horizontal':
                    return `
                        <div class="flex flex-wrap gap-2 justify-center">
                            ${Array.from({length: 31}, (_, i) => i + 1).map(num => {
                                const isSelected = dezenas.includes(num);
                                const bgColor = isSelected ? 'bg-diasorte-primary text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400';
                                return `<div class="number-ball w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold border-2 border-gray-300 ${bgColor}">${num.toString().padStart(2, '0')}</div>`;
                            }).join('')}
                        </div>
                    `;

                case 'vertical':
                    return `
                        <div class="grid grid-cols-5 gap-1">
                            ${Array.from({length: 31}, (_, i) => i + 1).map(num => {
                                const isSelected = dezenas.includes(num);
                                const bgColor = isSelected ? 'bg-diasorte-primary text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400';
                                return `<div class="number-ball aspect-square rounded-lg flex items-center justify-center text-xs font-bold border ${bgColor}">${num.toString().padStart(2, '0')}</div>`;
                            }).join('')}
                        </div>
                    `;

                case 'compact':
                    return `
                        <div class="flex flex-wrap gap-1 justify-center">
                            ${dezenas.sort((a, b) => a - b).map(num => {
                                return `<span class="inline-block bg-diasorte-primary text-white px-2 py-1 rounded text-xs font-bold">${num.toString().padStart(2, '0')}</span>`;
                            }).join('')}
                        </div>
                    `;

                case 'circles':
                    return `
                        <div class="flex flex-wrap gap-3 justify-center">
                            ${Array.from({length: 31}, (_, i) => i + 1).map(num => {
                                const isSelected = dezenas.includes(num);
                                const bgColor = isSelected ? 'bg-diasorte-primary text-white border-diasorte-primary shadow-lg' : 'bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-300 dark:border-gray-600';
                                return `<div class="number-ball w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold border-2 ${bgColor}">${num}</div>`;
                            }).join('')}
                        </div>
                    `;

                default: // grid 6x6
                    return `
                        <div class="grid grid-cols-6 gap-1">
                            ${Array.from({length: 36}, (_, i) => {
                                const num = i + 1;
                                if (num > 31) {
                                    return `<div class="aspect-square"></div>`; // Espa√ßo vazio
                                }
                                const isSelected = dezenas.includes(num);
                                const bgColor = isSelected ? 'bg-diasorte-primary text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400';
                                return `<div class="number-ball aspect-square rounded-lg flex items-center justify-center text-xs font-bold border ${bgColor}">${num.toString().padStart(2, '0')}</div>`;
                            }).join('')}
                        </div>
                    `;
            }
        }

        function showResultsInfo() {
            const resultsInfo = document.getElementById('resultsInfo');
            const loadedCount = document.getElementById('loadedCount');
            
            if (allResults.length > 0) {
                if (loadedCount) loadedCount.textContent = allResults.length;
                if (resultsInfo) resultsInfo.classList.remove('hidden');
            } else {
                if (resultsInfo) resultsInfo.classList.add('hidden');
            }
        }

        function calculateStatistics() {
            if (allResults.length === 0) {
                const statisticsDiv = document.getElementById('statistics');
                if (statisticsDiv) statisticsDiv.classList.add('hidden');
                return;
            }

            let totalOdds = 0;
            let totalEvens = 0;
            const numberFreq = {};
            
            // Inicializa contadores para n√∫meros 1-31
            for (let i = 1; i <= 31; i++) {
                numberFreq[i] = 0;
            }

            allResults.forEach(result => {
                const dezenas = result.listaDezenas.map(d => parseInt(d));
                const odds = dezenas.filter(num => num % 2 === 1).length;
                const evens = dezenas.filter(num => num % 2 === 0).length;
                totalOdds += odds;
                totalEvens += evens;
                
                // Conta frequ√™ncia de cada n√∫mero
                dezenas.forEach(num => {
                    if (num >= 1 && num <= 31) {
                        numberFreq[num]++;
                    }
                });
            });

            const totalNumbers = totalOdds + totalEvens;
            const gameCount = allResults.length;

            const oddAverage = (totalOdds / gameCount).toFixed(1);
            const evenAverage = (totalEvens / gameCount).toFixed(1);

            const oddFrequency = ((totalOdds / totalNumbers) * 100).toFixed(1);
            const evenFrequency = ((totalEvens / totalNumbers) * 100).toFixed(1);

            const difference = Math.abs(totalOdds - totalEvens);
            const mostDrawn = totalOdds > totalEvens ? '√çmpares' : totalEvens > totalOdds ? 'Pares' : 'Empate';
            
            // N√∫mero mais sorteado
            const sortedByFreq = Object.entries(numberFreq).sort(([,a], [,b]) => b - a);
            const mostDrawnNumber = sortedByFreq[0];
            
            // M√™s mais sorteado
            const sortedMonths = Object.entries(monthStats).sort(([,a], [,b]) => b - a);
            const mostDrawnMonth = sortedMonths[0];
            
            let tendency;
            if (difference <= gameCount * 0.5) {
                tendency = 'Equilibrado';
            } else if (totalOdds > totalEvens) {
                tendency = 'Tend√™ncia a √≠mpares';
            } else {
                tendency = 'Tend√™ncia a pares';
            }

            // Atualiza elementos
            const elements = {
                oddTotal: document.getElementById('oddTotal'),
                oddAverage: document.getElementById('oddAverage'),
                oddFrequency: document.getElementById('oddFrequency'),
                evenTotal: document.getElementById('evenTotal'),
                evenAverage: document.getElementById('evenAverage'),
                evenFrequency: document.getElementById('evenFrequency'),
                mostDrawn: document.getElementById('mostDrawn'),
                mostDrawnMonth: document.getElementById('mostDrawnMonth'),
                tendency: document.getElementById('tendency'),
                statistics: document.getElementById('statistics')
            };

            if (elements.oddTotal) elements.oddTotal.textContent = totalOdds;
            if (elements.oddAverage) elements.oddAverage.textContent = oddAverage;
            if (elements.oddFrequency) elements.oddFrequency.textContent = oddFrequency + '%';

            if (elements.evenTotal) elements.evenTotal.textContent = totalEvens;
            if (elements.evenAverage) elements.evenAverage.textContent = evenAverage;
            if (elements.evenFrequency) elements.evenFrequency.textContent = evenFrequency + '%';

            if (elements.mostDrawn && mostDrawnNumber) {
                elements.mostDrawn.textContent = `${mostDrawnNumber[0].padStart(2, '0')} (${mostDrawnNumber[1]}x)`;
            }
            
            if (elements.mostDrawnMonth && mostDrawnMonth) {
                const monthIndex = parseInt(mostDrawnMonth[0]);
                elements.mostDrawnMonth.textContent = `${monthNames[monthIndex]} (${mostDrawnMonth[1]}x)`;
            }
            
            if (elements.tendency) elements.tendency.textContent = tendency;

            if (elements.statistics) elements.statistics.classList.remove('hidden');
        }

        function clearResults() {
            console.log('üóëÔ∏è Limpando resultados');
            allResults = [];
            monthStats = {};
            
            const resultsDiv = document.getElementById('results');
            const resultsInfo = document.getElementById('resultsInfo');
            const statistics = document.getElementById('statistics');
            const error = document.getElementById('error');
            
            if (resultsDiv) resultsDiv.innerHTML = '';
            if (resultsInfo) resultsInfo.classList.add('hidden');
            if (statistics) statistics.classList.add('hidden');
            if (error) error.classList.add('hidden');
        }

        function showError(message) {
            console.error('‚ùå Erro:', message);
            const errorDiv = document.getElementById('error');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
            }
        }

        function toggleInfo() {
            const showInfo = document.getElementById('showInfo');
            const toggleIcon = document.getElementById('toggleIcon');
            
            if (showInfo && toggleIcon) {
                showInfo.checked = !showInfo.checked;
                toggleIcon.textContent = showInfo.checked ? '‚àí' : '+';
                renderResults();
            }
        }

        // Event listeners
        function initEventListeners() {
            console.log('üîó Configurando event listeners do Dia de Sorte');
            
            const loadBtn = document.getElementById('loadBtn');
            if (loadBtn) {
                loadBtn.addEventListener('click', () => {
                    console.log('üëÜ Bot√£o Carregar clicado');
                    loadResults();
                });
            }
            
            const viewType = document.getElementById('viewType');
            if (viewType) {
                viewType.addEventListener('change', () => {
                    console.log('üëÅÔ∏è Visualiza√ß√£o alterada');
                    renderResults();
                });
            }
            
            const sortOrder = document.getElementById('sortOrder');
            if (sortOrder) {
                sortOrder.addEventListener('change', () => {
                    console.log('üîÑ Ordem alterada');
                    renderResults();
                });
            }
            
            const columns = document.getElementById('columns');
            if (columns) {
                columns.addEventListener('change', () => {
                    console.log('üìä Colunas alteradas');
                    renderResults();
                });
            }
            
            const showInfo = document.getElementById('showInfo');
            if (showInfo) {
                showInfo.addEventListener('change', () => {
                    console.log('‚ÑπÔ∏è Info alterada');
                    renderResults();
                });
            }
            
            const limit = document.getElementById('limit');
            if (limit) {
                limit.addEventListener('change', () => {
                    console.log('üìä Limite alterado');
                    loadResults();
                });
            }
            
            const showInfoBtn = document.getElementById('showInfoBtn');
            if (showInfoBtn) {
                showInfoBtn.addEventListener('click', toggleInfo);
            }
            
            const clearResults = document.getElementById('clearResults');
            if (clearResults) {
                clearResults.addEventListener('click', () => {
                    console.log('üóëÔ∏è Limpar clicado');
                    clearResults();
                });
            }
            
            // Modal
            const helpBtn = document.getElementById('helpBtn');
            const closeModal = document.getElementById('closeModal');
            const closeModalFooter = document.getElementById('closeModalFooter');
            const helpModal = document.getElementById('helpModal');
            
            if (helpBtn && helpModal) {
                helpBtn.addEventListener('click', () => helpModal.classList.remove('hidden'));
            }
            
            if (closeModal && helpModal) {
                closeModal.addEventListener('click', () => helpModal.classList.add('hidden'));
            }
            
            if (closeModalFooter && helpModal) {
                closeModalFooter.addEventListener('click', () => helpModal.classList.add('hidden'));
            }
            
            if (helpModal) {
                helpModal.addEventListener('click', (e) => {
                    if (e.target.id === 'helpModal') {
                        helpModal.classList.add('hidden');
                    }
                });
            }
        }

        // Inicializa√ß√£o
        function init() {
            console.log('üé¨ Inicializando aplica√ß√£o Dia de Sorte');
            
            try {
                initEventListeners();
                console.log('‚úÖ Event listeners configurados');
                
                // Carrega automaticamente
                console.log('üîÑ Carregando dados iniciais do Dia de Sorte');
                loadResults();
                
            } catch (error) {
                console.error('‚ùå Erro na inicializa√ß√£o:', error);
                showError('Erro na inicializa√ß√£o: ' + error.message);
            }
        }

        // Inicializa quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        console.log('‚úÖ Script Dia de Sorte carregado completamente');
    </script>
</body>
</html>